<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å‡ºå·®ç´€éŒ„ç®¡ç†</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
    }

    body {
      margin: 0;
      padding: 24px;
      background: #f5f5f7;
      color: #222;
    }

    h1 {
      text-align: center;
      margin-bottom: 16px;
      font-size: 24px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: #fff;
      border-radius: 10px;
      padding: 20px 24px 24px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.06);
    }

    .form-row {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .form-group {
      flex: 1 1 200px;
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-size: 13px;
      margin-bottom: 4px;
      color: #444;
    }

    input[type="text"],
    input[type="date"],
    textarea {
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      transition: border 0.15s, box-shadow 0.15s;
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    textarea:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.15);
    }

    textarea {
      min-height: 60px;
      resize: vertical;
    }

    .actions-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 12px 0 8px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .left-actions,
    .right-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.15s, transform 0.05s, box-shadow 0.15s;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    button:active {
      transform: scale(0.97);
    }

    .btn-primary {
      background: #2563eb;
      color: #fff;
      box-shadow: 0 6px 15px rgba(37, 99, 235, 0.25);
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .btn-secondary:hover {
      background: #d1d5db;
    }

    .btn-text {
      background: transparent;
      padding: 4px 8px;
      border-radius: 6px;
    }

    .btn-text:hover {
      background: rgba(0, 0, 0, 0.04);
    }

    .btn-danger {
      background: #ef4444;
      color: #fff;
      box-shadow: 0 6px 15px rgba(239, 68, 68, 0.25);
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e5e7eb;
      color: #374151;
      margin-left: 4px;
    }

    .search-input {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      min-width: 180px;
    }

    .search-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.15);
    }

    .table-wrapper {
      margin-top: 12px;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    thead {
      background: #f9fafb;
    }

    th,
    td {
      padding: 10px 8px;
      border-bottom: 1px solid #e5e7eb;
      vertical-align: top;
      text-align: left;
    }

    th {
      font-weight: 600;
      color: #374151;
      user-select: none;
    }

    tr:nth-child(even) td {
      background: #fbfbfb;
    }

    tr:hover td {
      background: #eff6ff;
    }

    .col-actions {
      white-space: nowrap;
      text-align: right;
    }

    .muted {
      color: #6b7280;
      font-size: 12px;
    }

    .empty-state {
      padding: 18px;
      text-align: center;
      font-size: 13px;
      color: #6b7280;
    }

    .sort-indicator {
      font-size: 11px;
      margin-left: 2px;
      opacity: 0.8;
    }

    .nowrap {
      white-space: nowrap;
    }

    @media (max-width: 700px) {
      .form-row {
        flex-direction: column;
      }

      .col-actions {
        text-align: left;
      }

      table,
      thead,
      tbody,
      th,
      td,
      tr {
        display: block;
      }

      thead {
        display: none;
      }

      tr {
        margin-bottom: 8px;
        border-bottom: 1px solid #e5e7eb;
      }

      td {
        border: none;
        padding: 6px 10px;
      }

      td::before {
        content: attr(data-label);
        font-weight: 600;
        display: block;
        margin-bottom: 2px;
        color: #374151;
      }

      .table-wrapper {
        border-radius: 8px;
      }
    }
  </style>
</head>
<body>
  <h1>å‡ºå·®ç´€éŒ„ç®¡ç†</h1>
  <div class="container">
    <!-- è¡¨å–®å€ -->
    <form id="tripForm">
      <div class="form-row">
        <div class="form-group">
          <label for="employeeName">å§“å (employeeName)</label>
          <input id="employeeName" type="text" required />
        </div>
        <div class="form-group">
          <label for="destination">ç›®çš„åœ° / åœ°é» (destination)</label>
          <input id="destination" type="text" required />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="startDate">é–‹å§‹æ—¥æœŸ (startDate)</label>
          <input id="startDate" type="date" required />
        </div>
        <div class="form-group">
          <label for="endDate">çµæŸæ—¥æœŸ (endDate)</label>
          <input id="endDate" type="date" required />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="description">ä¸»è¦å·¥ä½œå…§å®¹ (description)</label>
          <textarea id="description" placeholder="å¯ç°¡å–®è¨˜éŒ„å‡ºå·®ç›®çš„èˆ‡å·¥ä½œé‡é»"></textarea>
        </div>
      </div>

      <div class="actions-row">
        <div class="left-actions">
          <button type="submit" class="btn-primary" id="submitBtn">æ–°å¢å‡ºå·®ç´€éŒ„</button>
          <button type="button" class="btn-secondary" id="cancelEditBtn" style="display:none;">å–æ¶ˆç·¨è¼¯</button>
          <span class="muted" id="editHint" style="display:none;">ç›®å‰ç‚ºç·¨è¼¯æ¨¡å¼</span>
        </div>
        <div class="right-actions">
          <input
            type="text"
            id="searchInput"
            class="search-input"
            placeholder="æœå°‹å§“åæˆ–åœ°é»é—œéµå­—..."
          />
          <button type="button" class="btn-text nowrap" id="sortBtn">
            ä¾é–‹å§‹æ—¥æœŸæ’åº
            <span class="sort-indicator" id="sortIndicator">â–²ï¼ˆèˆŠâ†’æ–°ï¼‰</span>
          </button>
        </div>
      </div>
    </form>

    <!-- è¡¨æ ¼å€ -->
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>å§“å</th>
            <th>ç›®çš„åœ° / åœ°é»</th>
            <th class="nowrap">é–‹å§‹æ—¥æœŸ</th>
            <th class="nowrap">çµæŸæ—¥æœŸ</th>
            <th>å·¥ä½œå…§å®¹</th>
            <th class="col-actions">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="tripTableBody">
          <!-- å‹•æ…‹æ¸²æŸ“ -->
        </tbody>
      </table>
      <div class="empty-state" id="emptyState" style="display:none;">
        ç›®å‰å°šç„¡å‡ºå·®ç´€éŒ„ï¼Œè«‹å…ˆä¸Šæ–¹æ–°å¢ä¸€ç­† ğŸ™Œ
      </div>
    </div>
    <div class="muted" style="margin-top:8px;">
      è³‡æ–™æœƒè‡ªå‹•å„²å­˜åœ¨ç€è¦½å™¨çš„ localStorage ä¸­ï¼Œé‡æ–°æ•´ç†ä¹Ÿä¸æœƒæ¶ˆå¤±ã€‚
    </div>
  </div>

  <script>
    (function () {
      const STORAGE_KEY = "businessTripRecords_v1";

      // ç‹€æ…‹
      let trips = [];
      let currentSortDirection = "asc"; // asc: èˆŠâ†’æ–°, desc: æ–°â†’èˆŠ
      let currentKeyword = "";
      let editingId = null;

      // DOM å…ƒç´ 
      const tripForm = document.getElementById("tripForm");
      const employeeNameInput = document.getElementById("employeeName");
      const destinationInput = document.getElementById("destination");
      const startDateInput = document.getElementById("startDate");
      const endDateInput = document.getElementById("endDate");
      const descriptionInput = document.getElementById("description");

      const submitBtn = document.getElementById("submitBtn");
      const cancelEditBtn = document.getElementById("cancelEditBtn");
      const editHint = document.getElementById("editHint");

      const searchInput = document.getElementById("searchInput");
      const sortBtn = document.getElementById("sortBtn");
      const sortIndicator = document.getElementById("sortIndicator");

      const tripTableBody = document.getElementById("tripTableBody");
      const emptyState = document.getElementById("emptyState");

      // å·¥å…·å‡½å¼
      function loadFromStorage() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) {
            trips = [];
            return;
          }
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) {
            trips = parsed;
          } else {
            trips = [];
          }
        } catch (e) {
          console.error("è®€å– localStorage ç™¼ç”ŸéŒ¯èª¤ï¼š", e);
          trips = [];
        }
      }

      function saveToStorage() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(trips));
        } catch (e) {
          console.error("å¯«å…¥ localStorage ç™¼ç”ŸéŒ¯èª¤ï¼š", e);
        }
      }

      function resetForm() {
        tripForm.reset();
        editingId = null;
        submitBtn.textContent = "æ–°å¢å‡ºå·®ç´€éŒ„";
        cancelEditBtn.style.display = "none";
        editHint.style.display = "none";
      }

      function setEditMode(trip) {
        editingId = trip.id;
        employeeNameInput.value = trip.employeeName || "";
        destinationInput.value = trip.destination || "";
        startDateInput.value = trip.startDate || "";
        endDateInput.value = trip.endDate || "";
        descriptionInput.value = trip.description || "";
        submitBtn.textContent = "æ›´æ–°å‡ºå·®ç´€éŒ„";
        cancelEditBtn.style.display = "inline-flex";
        editHint.style.display = "inline";
      }

      function toggleSortDirection() {
        currentSortDirection = currentSortDirection === "asc" ? "desc" : "asc";
        sortIndicator.textContent =
          currentSortDirection === "asc"
            ? "â–²ï¼ˆèˆŠâ†’æ–°ï¼‰"
            : "â–¼ï¼ˆæ–°â†’èˆŠï¼‰";
        render();
      }

      function filterAndSortTrips() {
        let filtered = trips;

        if (currentKeyword.trim() !== "") {
          const kw = currentKeyword.trim().toLowerCase();
          filtered = filtered.filter((trip) => {
            const name = (trip.employeeName || "").toLowerCase();
            const dest = (trip.destination || "").toLowerCase();
            return name.includes(kw) || dest.includes(kw);
          });
        }

        filtered = filtered.slice().sort((a, b) => {
          const da = new Date(a.startDate).getTime();
          const db = new Date(b.startDate).getTime();
          if (isNaN(da) && isNaN(db)) return 0;
          if (isNaN(da)) return 1;
          if (isNaN(db)) return -1;
          return currentSortDirection === "asc" ? da - db : db - da;
        });

        return filtered;
      }

      function render() {
        const rows = filterAndSortTrips();
        tripTableBody.innerHTML = "";

        if (rows.length === 0) {
          emptyState.style.display = "block";
          return;
        } else {
          emptyState.style.display = "none";
        }

        rows.forEach((trip) => {
          const tr = document.createElement("tr");

          const nameTd = document.createElement("td");
          nameTd.textContent = trip.employeeName || "";
          nameTd.setAttribute("data-label", "å§“å");

          const destTd = document.createElement("td");
          destTd.textContent = trip.destination || "";
          destTd.setAttribute("data-label", "ç›®çš„åœ° / åœ°é»");

          const startTd = document.createElement("td");
          startTd.textContent = trip.startDate || "";
          startTd.className = "nowrap";
          startTd.setAttribute("data-label", "é–‹å§‹æ—¥æœŸ");

          const endTd = document.createElement("td");
          endTd.textContent = trip.endDate || "";
          endTd.className = "nowrap";
          endTd.setAttribute("data-label", "çµæŸæ—¥æœŸ");

          const descTd = document.createElement("td");
          descTd.textContent = trip.description || "";
          descTd.setAttribute("data-label", "å·¥ä½œå…§å®¹");

          const actionsTd = document.createElement("td");
          actionsTd.className = "col-actions";
          actionsTd.setAttribute("data-label", "æ“ä½œ");

          const editBtn = document.createElement("button");
          editBtn.type = "button";
          editBtn.className = "btn-text";
          editBtn.textContent = "ç·¨è¼¯";
          editBtn.addEventListener("click", () => {
            setEditMode(trip);
          });

          const deleteBtn = document.createElement("button");
          deleteBtn.type = "button";
          deleteBtn.className = "btn-text";
          deleteBtn.style.color = "#b91c1c";
          deleteBtn.textContent = "åˆªé™¤";
          deleteBtn.addEventListener("click", () => {
            const ok = confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†å‡ºå·®ç´€éŒ„å—ï¼Ÿ");
            if (!ok) return;
            trips = trips.filter((t) => t.id !== trip.id);
            saveToStorage();
            if (editingId === trip.id) {
              resetForm();
            }
            render();
          });

          actionsTd.appendChild(editBtn);
          actionsTd.appendChild(deleteBtn);

          tr.appendChild(nameTd);
          tr.appendChild(destTd);
          tr.appendChild(startTd);
          tr.appendChild(endTd);
          tr.appendChild(descTd);
          tr.appendChild(actionsTd);

          tripTableBody.appendChild(tr);
        });
      }

      // äº‹ä»¶ç¶å®š
      tripForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const employeeName = employeeNameInput.value.trim();
        const destination = destinationInput.value.trim();
        const startDate = startDateInput.value;
        const endDate = endDateInput.value;
        const description = descriptionInput.value.trim();

        if (!employeeName || !destination || !startDate || !endDate) {
          alert("è«‹å…ˆå¡«å¯«å§“åã€ç›®çš„åœ°ã€é–‹å§‹èˆ‡çµæŸæ—¥æœŸã€‚");
          return;
        }

        if (new Date(endDate) < new Date(startDate)) {
          const ok = confirm("çµæŸæ—¥æœŸæ—©æ–¼é–‹å§‹æ—¥æœŸï¼Œç¢ºå®šè¦å„²å­˜å—ï¼Ÿ");
          if (!ok) return;
        }

        if (editingId) {
          // æ›´æ–°æ¨¡å¼
          const idx = trips.findIndex((t) => t.id === editingId);
          if (idx !== -1) {
            trips[idx] = {
              ...trips[idx],
              employeeName,
              destination,
              startDate,
              endDate,
              description,
              updatedAt: new Date().toISOString(),
            };
          }
        } else {
          // æ–°å¢æ¨¡å¼
          const newTrip = {
            id: "trip_" + Date.now() + "_" + Math.random().toString(16).slice(2),
            employeeName,
            destination,
            startDate,
            endDate,
            description,
            createdAt: new Date().toISOString(),
          };
          trips.push(newTrip);
        }

        saveToStorage();
        resetForm();
        render();
      });

      cancelEditBtn.addEventListener("click", function () {
        resetForm();
      });

      searchInput.addEventListener("input", function () {
        currentKeyword = searchInput.value;
        render();
      });

      sortBtn.addEventListener("click", function () {
        toggleSortDirection();
      });

      // åˆå§‹åŒ–
      loadFromStorage();
      render();
    })();
  </script>
</body>
</html>
